---
import MainLayout, { jwtDetails } from "../../layouts/main.astro";
import Padding from "../../layouts/padding.astro";
import { Image } from "astro:assets";
import { Role } from "../../models/enums";

if (
  !(jwtDetails.getRole() === Role.ADMIN || jwtDetails.getRole() == Role.VISITOR)
) {
  return Astro.redirect("/");
}
const authorization = Astro.cookies.get("Authorization")?.value ?? "";
const options = {
  headers: {
    "content-type": "application/json",
    authorization: authorization,
  },
  method: "GET",
};
const response = await fetch(`${process.env.SERVER}/api/v1/users`, options);
const body = await response.json();
---

<MainLayout title="Users - Index" description="Verify all registered users.">
  <Padding>
    <section class="flex flex-col-reverse lg:flex-row px-2" transition:animate="fade">
      <div
        class="h-96 w-full overflow-y-auto lg:w-1/4"
        transition:persist
      >
        {
          body.map((item: any) => (
            <a
              class="my-2 flex h-20 items-center justify-between rounded-md border bg-gray-100 px-4 py-2 dark:border-neutral-900 dark:bg-neutral-700 dark:text-white"
              href={`/users/${item.id}`}
            >
              <span class="">
                <Image
                  width={32}
                  height={32}
                  class="rounded-full border border-neutral-900"
                  src={
                    item.profilePictureUrl === ""
                      ? "https://upload.wikimedia.org/wikipedia/commons/8/89/Portrait_Placeholder.png"
                      : item.profilePictureUrl
                  }
                  alt={`user ${item.id}`}
                  loading={"eager"}
                />{" "}
              </span>
              <span class="line-clamp-1 dark:text-white ml-2">
                {jwtDetails.getRole() === Role.ADMIN ? item.name : <Fragment />}
                {jwtDetails.getRole() === Role.VISITOR ? item.id : <Fragment />}
              </span>
            </a>
          ))
        }
      </div>
      <div class="w-full mt-2 lg:m-4 lg:w-3/4" transition:animate="fade">
        <slot />
      </div>
    </section>
  </Padding>
</MainLayout>
